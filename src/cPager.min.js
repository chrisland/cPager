/* cPager 0.5.2 */
function cPager(t){"use strict";this._page,this._open=0,this._lastopen=0,this._history=[],this._pageClass="",this._bodyClass="",this.animate=!1,this._fieldsDB=!1,this._opt={debug:!1,container:"page",handler:"pageBtn",handlerOff:"pageBtnOff",handlerField:"pageField",tmpl:[],tmplPath:"tmpl",ctrl:[],ctrlPath:"tasks",api:[],tasks:[],start:{page:!1,task:!1,content:!1,param:{history:!0}},animate:{timing:!1,direction:"left",duration:2},onReady:!1,onSuccess:!1};var e=this;this._opt=this._h.deepExtend(this._opt,t);var a=this._opt.debug,n=this._opt.ctrl.length+ +this._opt.tmpl.length+this._opt.api.length||0;function s(){if(0==--n||n<0){var t=localStorage.getItem("cPagerFields");t||(t="{}"),e._fieldsDB=JSON.parse(t)||{},e._opt.onReady&&"function"==typeof e._opt.onReady&&(a&&console.log("cPager - onReady"),e._opt.onReady()),e._lastopen?(a&&console.log("cPager - switch loaded: to last open",e._lastopen),e.switch(e._lastopen)):e._opt.start&&e._opt.start.page&&(a&&console.log("cPager - switch loaded: to start",e._opt.start),e.switch(e._opt.start.page,e._opt.start.task,e._opt.start.content,e._opt.start.param))}}if(this._page=document.getElementById(this._opt.container),!this._page)throw new Error("missing main container #"+this._opt.container);if(this._pageClass=this._page.className||"",this._bodyClass=document.body.className||"",a&&console.log("cPager - initialize"),this._opt.ctrl)for(var i in this._opt.ctrl)this._opt.ctrl.hasOwnProperty(i)&&this._h.loadScript(this._opt.ctrlPath+"/"+this._opt.ctrl[i]+".js",function(t){a&&console.log("cPager - load script: "+t),s()});return this.ajaxCache={},0<this._opt.tmpl.length&&this._h.cache(this,this._opt.tmpl,"tmpl",function(t){a&&console.log("cPager - cache tmpl page: ",t),s()}),0<this._opt.api.length&&this._h.cache(this,this._opt.api,"api",function(t){a&&console.log("cPager - cache api page: ",t),s()}),n&&0!=n||s(),this}function nodeScriptReplace(t){if(!0===nodeScriptIs(t))t.parentNode.replaceChild(nodeScriptClone(t),t);else for(var e=0,a=t.childNodes;e<a.length;)nodeScriptReplace(a[e++]);return t}function nodeScriptIs(t){return"SCRIPT"===t.tagName}function nodeScriptClone(t){var e=document.createElement("script");e.text=t.innerHTML;for(var a=t.attributes.length-1;0<=a;a--)e.setAttribute(t.attributes[a].name,t.attributes[a].value);return e}cPager.prototype.param=function(t){return this._opt=this._h.deepExtend(this._opt,t),!1},cPager.prototype.switch=function(t,e,a,n){return this.load(t,e,a,n),this},cPager.prototype.load=function(t,e,a,n){var s=null;if(n&&n.event&&(s=n.event),"back"==e){var i=parseInt(a)+1||2,o=this.getHistory(),r=o[o.length-i];if(!r)return!1;if(!r.url)return!1;s=s||r.param.event,t=r.url,e=r.task,a=r.content,n=n||r.param,this.removeHistory(i)}return n||(n={}),this.switch.task=this._h.getTask(s,e,a,t,this,n),!(e&&!this.switch.task)&&(t?this._h.loadPage(this,"./"+this._opt.tmplPath+"/"+t+".tpl",t,e,a,n):this.switch.task&&"function"==typeof this.switch.task&&this.switch.task(),this)},cPager.prototype.events=function(){function t(t){if(l._opt.handlerOff&&this.classList.contains(l._opt.handlerOff))return!1;if(l.animate)return!1;var e=this.getAttribute("data-page"),a=this.getAttribute("data-task"),n=this.getAttribute("data-content"),s=this.getAttribute("data-container")||!1,i=this.getAttribute("data-animate")||l._opt.animate.timing,o=this.getAttribute("data-duration")||l._opt.animate.duration,r=this.getAttribute("data-direction")||l._opt.animate.direction,c=this.getAttribute("data-force")||!1,h=this.getAttribute("data-history")||!0;if(e||a){if(l._open==e&&!c)return!1;var p={event:t,history:h,animate:i,duration:o,direction:r,container:s||!1};console.log(p),l.switch(e,a,n,p)}}for(var l=this,e=document.getElementsByClassName(this._opt.handler),a=0;a<e.length;a++)e[a].style.curser="pointer",e[a].onclick||(e[a].onclick=t);function n(t){var e=t.target.getAttribute("name");e&&this.setFieldDB(this._open,e,t.target.value)}var s=document.getElementsByClassName(this._opt.handlerField);for(a=0;a<s.length;a++){var i=s[a].getAttribute("name");i&&!s[a].onchange&&(s[a].onchange=n.bind(this),s[a].value=this.getFieldDB(this._open,i))}return!0},cPager.prototype.getFieldDB=function(t,e){return this._fieldsDB[t]&&this._fieldsDB[t][e]?this._fieldsDB[t][e]:""},cPager.prototype.setFieldDB=function(t,e,a){return!!t&&(!!e&&(a||(a=""),this._fieldsDB[t]||(this._fieldsDB[t]={}),this._fieldsDB[t][e]=a,localStorage.setItem("cPagerFields",JSON.stringify(this._fieldsDB)),!0))},cPager.prototype.getHistory=function(){return!!this._history&&this._history},cPager.prototype.removeHistory=function(t){return t&&!isNaN(t)&&0<this._history.length?this._history=this._history.slice(0,this._history.length-t):this._history=[],!0},cPager.prototype.addHistory=function(t,e,a,n){var s={url:t,task:e,content:a,param:n};return this._history.push(s),!0},cPager.prototype.ctrl=function(t,e){if(!t||"string"!=typeof t||!e||"object"!=typeof e)return!1;for(var a in this._opt.tasks[t]&&"object"==typeof this._opt.tasks[t]||(this._opt.tasks[t]={}),e)e.hasOwnProperty(a)&&(this._opt.tasks[t][a]=e[a]);return!0},cPager.prototype._h={deepExtend:function(t){t=t||{};for(var e=1;e<arguments.length;e++){var a=arguments[e];if(a)for(var n in a)a.hasOwnProperty(n)&&("object"==typeof a[n]?t[n]=this.deepExtend(t[n],a[n]):t[n]=a[n])}return t},getTask:function(t,e,a,n,s,i){if(s._opt.tasks&&e){var o=e.split(".");if(0<o.length){var r=!1,c=!1;return o[0]&&o[1]&&s._opt.tasks[o[0]]&&s._opt.tasks[o[0]][o[1]]?(r=s._opt.tasks[o[0]][o[1]],c=s._opt.tasks[o[0]]):o[0]&&s._opt.tasks[o[0]]&&(r=s._opt.tasks[o[0]],c=s._opt.tasks),r&&"function"==typeof r?r({page:n||s._open,content:a,event:t,node:s._page,scope:c}):(console.error("cPager Error: missing task function",e),!1)}}return!1},successPage:function(t,e,a,n,s,i){t.switch.task&&"function"==typeof t.switch.task&&(t.switch.afterAnimate=t.switch.task(i||t._page)),s.animate||t.events(),s&&"false"!=String(s.history)&&t.addHistory(e,a,n,s),s&&s.onReady&&"function"==typeof s.onReady&&s.onReady(),nodeScriptReplace(i),t._opt.onSuccess&&"function"==typeof t._opt.onSuccess&&t._opt.onSuccess({scope:t,data:{page:e||t._open,task:a,content:n,param:s},node:i})},successAnimate:function(t,e,a,n,s,i){t.animate=!1,t.switch.task&&t.switch.afterAnimate&&"function"==typeof t.switch.afterAnimate&&t.switch.afterAnimate(),t.events()},appendPage:function(t,e,a,n,s,i){var o=s._page;if(i&&i.container&&!(o=document.getElementById(i.container)))throw new Error("missing container #"+this._opt.container);var r=e.replace(/\//gi,"-");document.body.className=s._bodyClass+" "||"",document.body.className+=" cPager-body-"+r,i&&i.direction?this.animatePage(s,e,a,n,i,o,r,t):(o.innerHTML=t,o.className=s._pageClass+" "||"",o.className+="cPager-"+r,s._lastopen=s._open,s._open=e,this.successPage(s,e,a,n,i,o))},animatePage:function(t,e,a,n,s,i,o,r){t.animate=!0,s.duration||(s.duration=t._opt.animate.duration),s.direction||(s.direction=t._opt.animate.direction),i.id=t._opt.container+"Temp",i.style.width=i.clientWidth+"px",i.style.height=i.clientHeight+"px",i.style.position="fixed",i.style.transform="translate3d(0,0,0)",i.style.transition="transform "+s.duration+"s "+s.animate;var c=document.createElement("div");switch(c.id=t._opt.container,c.className=t._pageClass+" "||"",c.className+="cPager-"+o,c.innerHTML=r,c.style.position="fixed",c.style.width=i.clientWidth+"px",c.style.height=i.clientHeight+"px",s.direction){case"left":default:c.style.transform="translate3d("+i.style.width+",0,0)";break;case"right":c.style.transform="translate3d(-"+i.style.width+",0,0)";break;case"top":c.style.transform="translate3d(0,"+i.style.height+",0)";break;case"bottom":c.style.transform="translate3d(0,-"+i.style.height+",0)"}c.style.transition="transform "+s.duration+"s "+s.animate,document.body.insertBefore(c,i.nextSibling),setTimeout(function(){switch(s.direction){case"left":default:i.style.transform="translate3d(-"+i.style.width+",0,0)";break;case"right":i.style.transform="translate3d("+i.style.width+",0,0)";break;case"top":i.style.transform="translate3d(0,-"+i.style.height+",0)";break;case"bottom":i.style.transform="translate3d(0,"+i.style.height+",0)"}c.style.transform="translate3d(0,0,0)",t._lastopen=t._open,t._open=e,t._page=c,t._h.successPage(t,e,a,n,s,c)},100),setTimeout(function(){i.remove(),t._h.successAnimate(t,e,a,n,s,c),i.style.transition="",c.style.transition="",document.body.className=t._bodyClass+" "||"",document.body.className+="cPager-body-"+o},1e3*s.duration+100)},loadPage:function(e,a,n,s,i,o){var r=this;e.ajaxCache[a]?r.appendPage(e.ajaxCache[a],n,s,i,e,o):this.sendRequest(a,function(t){e.ajaxCache[a]=t,r.appendPage(t,n,s,i,e,o)})},cache:function(n,t,e,s){for(var a=0;a<t.length;a++)if("api"==e)t[a]&&fetch(t[a]).then(function(t){return t.json()}).then(function(t){if(t.version<1);else if(t.data)for(var e in t.data){var a="./"+n._opt.tmplPath+"/"+e+".tpl";localStorage.setItem(a,t.data[e].html),n.ajaxCache[a]=t.data[e].html}s&&"function"==typeof s&&s(t)}).catch(function(t){console.error("Failed to fetch page: ",t)});else{var i="./"+n._opt.tmplPath+"/"+t[a]+".tpl";n._opt.debug&&(i=i+"?t="+Math.random(1,100)),this.sendRequest(i,function(t,e){n.ajaxCache[e]=t,s&&"function"==typeof s&&s(e)})}},sendRequest:function(e,a,t){if(window.jQuery)jQuery.ajax({url:e,dataType:"html",cache:!1}).done(function(t){a(t,e)}).fail(function(t){console.log("cPager - jQuery ajax error",e,t)});else{var n=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var s=function(){for(var t=!1,e=0;e<n.length;e++){try{t=n[e]()}catch(t){continue}break}return t}();if(!s)return;var i=t?"POST":"GET";if(s.open(i,e,!0),s.setRequestHeader("User-Agent","XMLHTTP/1.0"),t&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){4==s.readyState&&(200!=s.status&&304!=s.status||a(s.responseText,e))},4==s.readyState)return;s.send(t)}},loadScript:function(t,e){var a=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=t,n.onreadystatechange=e,n.onload=function(){e&&"function"==typeof e&&e(t)},a.appendChild(n)}};